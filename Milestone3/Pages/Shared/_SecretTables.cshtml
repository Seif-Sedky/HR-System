<div id="secret-container" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; overflow: hidden;"></div>

<div id="secret-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; opacity: 0; transition: opacity 1s ease;">
    <div class="story-container">
        <h1 id="typewriter-text"></h1>
    </div>
</div>

<style>
    /* --- TABLE STYLING --- */
    .dragon-table {
        position: absolute;
        width: 400px;
        height: auto;
        will-change: transform, top, left;
        transition: top 1.5s ease-in, transform 0.8s ease-out;
    }

    .db-grid {
        width: 100%;
        height: auto;
        background: #fdfdfd;
        border: 2px solid #34495e;
        border-radius: 6px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        position: relative;
        z-index: 10;
        overflow: hidden;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 11px;
        font-weight: 600;
    }

    .db-header {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 8px 10px;
        border-bottom: 2px solid #1a252f;
        display: flex;
        align-items: center;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 11px;
    }

    /* Rows Wrapper */
    .db-body {
        display: flex;
        flex-direction: column;
    }

    .db-row {
        display: flex;
        padding: 8px 10px;
        color: #333;
        align-items: center;
        border-bottom: 1px solid #e0e0e0;
    }

        .db-row:nth-child(even) {
            background: #f8f9fa;
        }

        .db-row:nth-child(odd) {
            background: #ffffff;
        }

        .db-row:last-child {
            border-bottom: none;
        }

    /* Columns */
    .col-name {
        width: 25%;
        text-align: left;
        color: #2980b9;
        font-weight: 800;
        flex-shrink: 0;
    }

    .col-count {
        width: 15%;
        text-align: center;
        color: #7f8c8d;
        flex-shrink: 0;
    }

    .col-status {
        width: 35%;
        text-align: center;
        display: flex;
        justify-content: center;
        flex-shrink: 0;
    }

    .col-m2 {
        width: 25%;
        text-align: right;
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        flex-shrink: 0;
    }

    /* Colors */
    .text-success {
        color: #27ae60;
    }

    .text-danger {
        color: #c0392b;
    }

    /* Status Badges */
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        color: white;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        animation: pulseBadge 2s infinite;
        display: inline-block;
        min-width: 60px;
        text-align: center;
    }

    .stat-bad {
        background-color: #e74c3c;
    }

    .stat-good {
        background-color: #27ae60;
    }

    .stat-weird {
        background-color: #e67e22;
    }

    .stat-legend {
        background: linear-gradient(45deg, #f1c40f, #d35400);
    }

    .stat-neutral {
        background-color: #95a5a6;
    }

    /* --- FIRE STYLES --- */
    .fire-nozzle {
        position: absolute;
        top: 50%;
        right: -25px;
        width: 20px;
        height: 20px;
        z-index: 5;
        transform: translateY(-50%);
    }

    .fire-particle {
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: radial-gradient(circle, #fff 15%, #ffcc00 45%, #ff4500 85%, transparent 100%);
        opacity: 0;
        transform: scale(0.2);
        mix-blend-mode: screen;
    }

    /* --- ANIMATION STATES --- */
    .tables-turned {
        animation: none !important;
        transform: rotate(180deg) !important;
        top: 150vh !important;
    }

    /* --- TEXT STYLES --- */
    .story-container {
        text-align: center;
        color: #f0f0f0;
        width: 100%;
        padding: 20px;
    }

    #typewriter-text {
        font-family: 'Georgia', 'Times New Roman', serif;
        font-size: clamp(2rem, 5vw, 6rem);
        line-height: 1.3;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        display: inline-block;
        margin: 0;
        white-space: normal;
    }

    .highlight {
        color: #ff4500;
        text-shadow: 0 0 20px #ff4500;
    }

    .cursor {
        display: inline-block;
        font-size: clamp(2rem, 5vw, 6rem);
        color: #ff4500;
        animation: blink 1s infinite;
        font-weight: 100;
        vertical-align: bottom; /* Fixes alignment on line break */
        margin-left: 2px;
    }

    /* KEYFRAMES */
    @@keyframes blink {
        0%, 100% {
            opacity: 1;
        }

        50% {
            opacity: 0;
        }
    }

    @@keyframes pulseBadge {
        0% {
            transform: scale(1);
            opacity: 1;
        }

        50% {
            transform: scale(1.05);
            opacity: 0.9;
        }

        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    @@keyframes spewFire {
        0% {
            transform: translateX(0) scale(0.4);
            opacity: 0.9;
        }

        100% {
            transform: translateX(220px) scale(2.2);
            opacity: 0;
        }
    }

    @@keyframes flyAcross {
        0% {
            transform: translate(0, 0) scale(var(--scale));
        }

        25% {
            transform: translate(var(--moveX1), var(--moveY1)) scale(var(--scale));
        }

        50% {
            transform: translate(var(--moveX2), var(--moveY2)) scale(var(--scale));
        }

        75% {
            transform: translate(var(--moveX3), var(--moveY3)) scale(var(--scale));
        }

        100% {
            transform: translate(var(--moveX4), var(--moveY4)) scale(var(--scale));
        }
    }
</style>

<script>
    document.addEventListener('keydown', function(event) {
        if (event.key.toLowerCase() === 't') {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
            toggleSecretFeature();
        }
    });

    let secretState = 0;
    let typingTimeout;

    function toggleSecretFeature() {
        const container = document.getElementById('secret-container');
        const overlay = document.getElementById('secret-overlay');
        const textField = document.getElementById('typewriter-text');

        if (secretState === 0) {
            // ACTIVATE
            secretState = 1;
            container.style.display = 'block';
            container.innerHTML = '';
            overlay.style.display = 'none';
            overlay.style.opacity = '0';
            textField.innerHTML = '';

            // Spawn 16 tables
            for (let i = 0; i < 16; i++) {
                spawnDatabaseDragon(container, i);
            }

        } else if (secretState === 1) {
            // TURN TABLES
            secretState = 2;

            const dragons = document.querySelectorAll('.dragon-table');
            dragons.forEach(d => {
                const rect = d.getBoundingClientRect();
                d.style.left = rect.left + 'px';
                d.style.top = rect.top + 'px';
                d.style.animation = 'none';
                void d.offsetWidth;
                d.classList.add('tables-turned');
            });

            setTimeout(() => {
                overlay.style.display = 'flex';
                requestAnimationFrame(() => {
                    overlay.style.opacity = '1';
                });

                setTimeout(() => {
                    typeWriter();
                }, 500);

            }, 1500);

            setTimeout(() => {
                resetSecretFeature();
            }, 8000);
        }
    }

    function resetSecretFeature() {
        const container = document.getElementById('secret-container');
        const overlay = document.getElementById('secret-overlay');

        overlay.style.opacity = '0';
        setTimeout(() => {
            overlay.style.display = 'none';
            container.style.display = 'none';
            container.innerHTML = '';
            secretState = 0;
            document.getElementById('typewriter-text').innerHTML = '';
        }, 1000);
    }

    function typeWriter() {
        const textElement = document.getElementById('typewriter-text');

        const content = "THIS IS HOW <span class='highlight'>THE TABLES</span><br>HAVE TURNED";

        // --- KEY FIX: Cursor is appended to string, not sibling HTML element ---
        const cursorHTML = "<span class='cursor'>|</span>";

        textElement.innerHTML = cursorHTML; // Start with just cursor
        let i = 0;
        let currentHTML = ""; // Tracks text without cursor

        function type() {
            if (i < content.length) {
                let char = content.charAt(i);

                // If we hit a tag starter '<', print the whole tag instantly
                if (char === '<') {
                    let tag = '';
                    while (content.charAt(i) !== '>' && i < content.length) {
                        tag += content.charAt(i);
                        i++;
                    }
                    tag += '>';
                    currentHTML += tag;
                } else {
                    currentHTML += char;
                }

                // --- UPDATE: Text + Cursor (Forces cursor to follow BR) ---
                textElement.innerHTML = currentHTML + cursorHTML;

                i++;
                let speed = 50 + Math.random() * 50;
                typingTimeout = setTimeout(type, speed);
            }
        }
        type();
    }

    function spawnDatabaseDragon(container, index) {
        const div = document.createElement('div');
        div.className = 'dragon-table';

        // Team Data
        const teamMembers = [
            { name: "Yoo", count: "1", status: "Cool", m2: "100%", badge: "stat-good" },
            { name: "Seif", count: "2", status: "Hypered", m2: "0%", badge: "stat-bad" },
            { name: "Nayer", count: "1", status: "1st Rank", m2: "0%", badge: "stat-bad" },
            { name: "Osama", count: "0", status: "OnePiece", m2: "0%", badge: "stat-weird" },
            { name: "MAHER (TA)", count: "⭐⭐⭐⭐⭐", status: "LEGEND", m2: "A+", badge: "stat-legend" }
        ];

        // Filler Data
        const fillerData = [
            { name: "SYS_CORE", count: "99", status: "Running", m2: "---", badge: "stat-neutral" },
            { name: "DB_LOGS", count: "0", status: "Idle", m2: "OK", badge: "stat-neutral" },
            { name: "CACHE_V2", count: "12Mb", status: "Purged", m2: "N/A", badge: "stat-neutral" },
            { name: "PING_NET", count: "4ms", status: "Stable", m2: "100%", badge: "stat-good" }
        ];

        const member = teamMembers[index % teamMembers.length];

        // Color Logic
        let m2Class = "text-danger";
        if (member.m2 === "100%" || member.m2 === "A+") m2Class = "text-success";

        let rowsHtml = `
            <div class="db-row">
                <span class="col-name">${member.name}</span>
                <span class="col-count">${member.count}</span>
                <span class="col-status"><span class="status-badge ${member.badge}">${member.status}</span></span>
                <span class="col-m2 ${m2Class}">${member.m2}</span>
            </div>
        `;

        const extraRowsCount = Math.floor(Math.random() * 3);

        for(let r=0; r < extraRowsCount; r++) {
            const filler = fillerData[Math.floor(Math.random() * fillerData.length)];
            let fillerM2Class = filler.m2 === "100%" ? "text-success" : "text-danger";
            if(filler.m2 === "---" || filler.m2 === "N/A") fillerM2Class = "";

            rowsHtml += `
                <div class="db-row">
                    <span class="col-name" style="color:#7f8c8d;">${filler.name}</span>
                    <span class="col-count">${filler.count}</span>
                    <span class="col-status"><span class="status-badge ${filler.badge}">${filler.status}</span></span>
                    <span class="col-m2 ${fillerM2Class}">${filler.m2}</span>
                </div>
            `;
        }

        div.innerHTML = `
            <div class="db-grid">
                <div class="db-header">
                    <span class="col-name">NAME</span>
                    <span class="col-count">COUNT</span>
                    <span class="col-status">STATUS</span>
                    <span class="col-m2">MILESTONE 2</span>
                </div>
                <div class="db-body">
                    ${rowsHtml}
                </div>
            </div>
            <div class="fire-nozzle"></div>
        `;

        const startY = Math.random() * 85;
        div.style.top = startY + 'vh';
        div.style.left = '-400px';

        const scale = 0.6 + Math.random() * 0.6;
        const duration = 4 + Math.random() * 5;

        div.style.setProperty('--scale', scale);
        div.style.setProperty('--moveX1', (25 + Math.random() * 10) + 'vw');
        div.style.setProperty('--moveY1', (Math.random() * 20 - 10) + 'vh');
        div.style.setProperty('--moveX2', (50 + Math.random() * 10) + 'vw');
        div.style.setProperty('--moveY2', (Math.random() * 20 - 10) + 'vh');
        div.style.setProperty('--moveX3', (75 + Math.random() * 10) + 'vw');
        div.style.setProperty('--moveY3', (Math.random() * 20 - 10) + 'vh');
        div.style.setProperty('--moveX4', '120vw');
        div.style.setProperty('--moveY4', (Math.random() * 20 - 10) + 'vh');

        div.style.animation = `flyAcross ${duration}s linear infinite`;
        div.style.animationDelay = (Math.random() * -5) + 's';
        div.style.zIndex = Math.floor(scale * 100);

        const nozzle = div.querySelector('.fire-nozzle');
        const pCount = 10 + Math.floor(Math.random() * 6);
        for(let p=0; p < pCount; p++) {
            const particle = document.createElement('div');
            particle.className = 'fire-particle';
            const pDur = 0.4 + Math.random() * 0.4;
            const pDelay = Math.random() * 1;
            particle.style.animation = `spewFire ${pDur}s ease-out infinite`;
            particle.style.animationDelay = pDelay + 's';
            nozzle.appendChild(particle);
        }

        container.appendChild(div);
    }
</script>